import{ai as v,ah as e,a as r}from"./index-WozvSfaz.js";import{r as E,v as O,I as f,w as P,n as _,m as y,p as w,k as N,x as Y}from"./ErpApp-AJk95zmD.js";import{I as B,M as x}from"./index-IF3fmOLJ.js";import{c as m}from"./calculate-XppRVO1U.js";import{aR as R,ax as M,aH as c,aI as a,aE as s,as as H,aK as b,B as I}from"./IdurarOs-2Q7XqIs7.js";function W({subTotal:l=0,current:i=null}){const{last_offer_number:t}=v(R);return t===void 0?e.jsx(e.Fragment,{}):e.jsx(K,{subTotal:l,current:i})}function K({subTotal:l=0,current:i=null}){const t=M(),{dateFormat:p}=E(),{last_offer_number:S}=v(R),[T,F]=r.useState(()=>S+1),[L,D]=r.useState(0),[d,j]=r.useState(0),[A,V]=r.useState(0),[k,q]=r.useState(()=>new Date().getFullYear()),C=n=>{j(n/100)};r.useEffect(()=>{if(i){const{taxRate:n=0,year:u,number:o}=i;j(n/100),q(u),F(o)}},[i]),r.useEffect(()=>{const n=m.add(m.multiply(l,d),l);V(m.multiply(l,d)),D(n)},[l,d]);const h=r.useRef(!1);return r.useEffect(()=>{h.current.click()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(c,{gutter:[12,0],children:[e.jsx(a,{className:"gutter-row",span:8,children:e.jsx(s.Item,{name:"lead",label:t("Lead"),rules:[{required:!0}],children:e.jsx(O,{entity:"lead",displayLabels:["name"],searchFields:"name",redirectLabel:"Add New Lead",withRedirect:!0,urlToRedirect:"/lead"})})}),e.jsx(a,{className:"gutter-row",span:3,children:e.jsx(s.Item,{label:t("number"),name:"number",initialValue:T,rules:[{required:!0}],children:e.jsx(f,{min:1,style:{width:"100%"}})})}),e.jsx(a,{className:"gutter-row",span:3,children:e.jsx(s.Item,{label:t("year"),name:"year",initialValue:k,rules:[{required:!0}],children:e.jsx(f,{style:{width:"100%"}})})}),e.jsx(a,{className:"gutter-row",span:6,children:e.jsx(P,{})}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx(s.Item,{label:t("status"),name:"status",rules:[{required:!1}],initialValue:"draft",children:e.jsx(_,{options:[{value:"draft",label:t("Draft")},{value:"pending",label:t("Pending")},{value:"sent",label:t("Sent")},{value:"accepted",label:t("Accepted")},{value:"declined",label:t("Declined")}]})})}),e.jsx(a,{className:"gutter-row",span:8,children:e.jsx(s.Item,{name:"date",label:t("Date"),rules:[{required:!0,type:"object"}],initialValue:y(),children:e.jsx(w,{style:{width:"100%"},format:p})})}),e.jsx(a,{className:"gutter-row",span:6,children:e.jsx(s.Item,{name:"expiredDate",label:t("Expire Date"),rules:[{required:!0,type:"object"}],initialValue:y().add(30,"days"),children:e.jsx(w,{style:{width:"100%"},format:p})})}),e.jsx(a,{className:"gutter-row",span:10,children:e.jsx(s.Item,{label:t("Note"),name:"notes",children:e.jsx(H,{})})})]}),e.jsx(b,{dashed:!0}),e.jsxs(c,{gutter:[12,12],style:{position:"relative"},children:[e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Item")})}),e.jsx(a,{className:"gutter-row",span:7,children:e.jsx("p",{children:t("Description")})}),e.jsxs(a,{className:"gutter-row",span:3,children:[e.jsx("p",{children:t("Quantity")})," "]}),e.jsx(a,{className:"gutter-row",span:4,children:e.jsx("p",{children:t("Price")})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Total")})})]}),e.jsx(s.List,{name:"items",children:(n,{add:u,remove:o})=>e.jsxs(e.Fragment,{children:[n.map(g=>e.jsx(B,{remove:o,field:g,current:i},g.key)),e.jsx(s.Item,{children:e.jsx(I,{type:"dashed",onClick:()=>u(),block:!0,icon:e.jsx(N,{}),ref:h,children:t("Add field")})})]})}),e.jsx(b,{dashed:!0}),e.jsxs("div",{style:{position:"relative",width:" 100%",float:"right"},children:[e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(s.Item,{children:e.jsx(I,{type:"primary",htmlType:"submit",icon:e.jsx(N,{}),block:!0,children:t("Save")})})}),e.jsx(a,{className:"gutter-row",span:4,offset:10,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px",margin:0,textAlign:"right"},children:[t("Sub Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(x,{readOnly:!0,value:l})})]}),e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:4,offset:15,children:e.jsx(s.Item,{name:"taxRate",rules:[{required:!0}],children:e.jsx(Y,{value:d,onChange:C,entity:"taxes",outputValue:"taxValue",displayLabels:["taxName"],withRedirect:!0,urlToRedirect:"/taxes",redirectLabel:t("Add New Tax"),placeholder:t("Select Tax Value")})})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(x,{readOnly:!0,value:A})})]}),e.jsxs(c,{gutter:[12,-5],children:[e.jsx(a,{className:"gutter-row",span:4,offset:15,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px",margin:0,textAlign:"right"},children:[t("Total")," :"]})}),e.jsx(a,{className:"gutter-row",span:5,children:e.jsx(x,{readOnly:!0,value:L})})]})]})]})}export{W as O};
