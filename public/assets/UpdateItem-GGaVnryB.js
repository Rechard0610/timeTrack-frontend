import{aw as A,av as I,ai as N,a as p,ax as O,ah as e}from"./index-WozvSfaz.js";import{m,P as Z,T,s as b,k as _,t as K}from"./ErpApp-AJk95zmD.js";import{ax as z,aE as F,B as v,aK as G,aF as J}from"./IdurarOs-2Q7XqIs7.js";import{e as E}from"./actions-iFxDMtyd.js";import{c as Y}from"./calculate-XppRVO1U.js";import{d as Q}from"./selectors-wTqr4dM2.js";import{t as L}from"./statusTagColor-sG5xH6CK.js";import{C as W}from"./CloseCircleOutlined--Y-SA1pW.js";function X({form:l,translate:x}){const s=()=>{l.submit()};return e.jsx(v,{onClick:s,type:"primary",icon:e.jsx(_,{}),children:x("update")})}function it({config:l,UpdateForm:x}){var C,D;const s=z();let{entity:d}=l;const f=A(),y=I(),{current:r,isLoading:$,isSuccess:S}=N(Q),[c]=F.useForm(),[k,h]=p.useState(0),w={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[o,H]=p.useState(r??w),{id:j}=O(),q=(t,a)=>{const u=a.items;let n=0;u&&(u.map(i=>{if(i&&i.quantity&&i.price){let g=Y.multiply(i.quantity,i.price);n=Y.add(n,g)}}),h(n))},M=t=>{let a={...t};if(t&&((t.date||t.expiredDate)&&(a.date=m(t.date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),a.expiredDate=m(t.expiredDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),t.items)){let u=[];t.items.map(n=>{const{quantity:i,price:g,itemName:R,description:U}=n,B=n.quantity*n.price;u.push({total:B,quantity:i,price:g,itemName:R,description:U})}),a.items=u}f(E.update({entity:d,id:j,jsonData:a}))};p.useEffect(()=>{S&&(c.resetFields(),h(0),f(E.resetAction({actionType:"update"})),y(`/${d.toLowerCase()}/read/${j}`))},[S]);const P=t=>{f(K.updateCurrency({data:{default_currency_code:t}}))};return p.useEffect(()=>{if(r){H(r);let t={...r};t.date&&(t.date=m(t.date)),t.expiredDate&&(t.expiredDate=m(t.expiredDate)),t.taxRate||(t.taxRate=0),P(r.currency);const{subTotal:a}=t;c.resetFields(),c.setFieldsValue(t),h(a)}},[r]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{onBack:()=>{y(`/${d.toLowerCase()}`)},title:s("update"),ghost:!1,tags:[e.jsx(T,{color:(C=L(o.status))==null?void 0:C.color,children:o.status&&s(o.status)},"status"),o.paymentStatus&&e.jsx(T,{color:(D=L(o.paymentStatus))==null?void 0:D.color,children:o.paymentStatus&&s(o.paymentStatus)},"paymentStatus")],extra:[e.jsx(v,{onClick:()=>{y(`/${d.toLowerCase()}`)},icon:e.jsx(W,{}),children:s("Cancel")},`${b.generate()}`),e.jsx(X,{translate:s,form:c},`${b.generate()}`)],style:{padding:"20px 0px"}}),e.jsx(G,{dashed:!0}),e.jsx(J,{isLoading:$,children:e.jsx(F,{form:c,layout:"vertical",onFinish:M,onValuesChange:q,children:e.jsx(x,{subTotal:k,current:r})})})]})}export{it as U};
